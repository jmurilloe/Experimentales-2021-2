clear all; close all;
Vr=[0	0	-0.03	-0.05	-0.07	-0.08	-0.1	-0.13	-0.16	-0.18	-0.21	-0.22	-0.26	-0.27	-0.29	-0.3	-0.32	-0.34	-0.36	-0.37	-0.39	-0.4	-0.42	-0.45	-0.46	-0.48	-0.49	-0.52	-0.54	-0.56	-0.58	-0.61	-0.63	-0.65	-0.67	-0.69	-0.7	-0.72	-0.73	-0.75	-0.76	-0.78	-0.8	-0.83	-0.84	-0.87	-0.89	-0.91	-0.93	-0.95	-0.97	-0.99	-1.01	-1.03	-1.05	-1.06	-1.09	-1.1	-1.12	-1.15	-1.17	-1.19	-1.19	-1.2	-1.22	-1.24	-1.26	-1.29	-1.31	-1.33	-1.36	-1.39	-1.41	-1.43	-1.46	-1.48	-1.5	-1.52	-1.54	-1.57	-1.58	-1.59	-1.62	-1.63	-1.66	-1.68	-1.72	-1.75	-1.78	-1.8	-1.83	-1.86	-1.88	-1.91	-1.92	-1.95	-1.97	-1.99	-2	-2.03	-2.06	-2.08	-2.12	-2.15	-2.18	-2.2	-2.23	-2.26	-2.28	-2.31	-2.33	-2.35	-2.38	-2.4	-2.43	-2.45	-2.48	-2.49	-2.53	-2.55	-2.58	-2.6	-2.63	-2.65	-2.68	-2.7	-2.73	-2.75	-2.78	-2.8	-2.83	-2.85	-2.88	-2.91	-2.94	-2.96	-3	-3.02	-3.05	-3.08	-3.1	-3.12	-3.15	-3.17	-3.2	-3.23	-3.25	-3.28	-3.3	-3.33	-3.35	-3.38	-3.41	-3.43	-3.46	-3.48	-3.51	-3.54	-3.57	-3.58	-3.6	-3.63	-3.65	-3.68	-3.71	-3.74	-3.78	-3.81	-3.85	-3.88	-3.91	-3.94	-3.97	-3.98	-3.98];
I=[90.9	89.4	87.3	82.6	80.8	79.3	76	73.5	70.3	67.5	64	60.4	57.9	54.8	53.4	51.1	49.7	47.6	46.3	43.8	42.5	41.6	40	37.5	35.7	34.2	32.8	31.2	29.7	27.7	25.6	24.1	22.4	20.6	19.2	17.8	16.7	15.5	14.6	13.8	12.5	11.6	10.6	9.7	8.3	7.9	6.6	5.9	5	4.5	3.5	3	2.2	1.9	1.4	1.1	0.5	0.3	-0.1	-0.3	-0.6	-0.7	-0.9	-0.8	-1.2	-1.3	-1.4	-1.5	-1.4	-1.6	-1.5	-1.6	-1.6	-1.6	-1.6	-1.7	-1.8	-1.8	-1.6	-1.8	-1.7	-1.6	-1.8	-1.7	-1.8	-1.8	-1.9	-2	-2	-1.8	-1.9	-1.8	-1.8	-1.8	-1.7	-1.8	-1.7	-1.8	-1.8	-1.9	-1.9	-1.9	-2	-2	-1.9	-1.9	-1.9	-1.9	-1.9	-1.8	-1.8	-1.7	-1.8	-1.7	-1.7	-1.7	-1.7	-1.7	-1.8	-1.7	-1.7	-1.7	-1.7	-1.8	-1.8	-1.9	-1.9	-1.8	-1.9	-1.9	-1.9	-2.1	-1.9	-2	-2	-1.9	-1.9	-1.9	-1.8	-1.8	-1.9	-1.8	-2	-1.9	-2	-2	-1.9	-2	-1.9	-1.9	-1.9	-2	-1.9	-1.8	-1.9	-1.8	-1.9	-1.9	-1.9	-1.7	-1.8	-1.8	-1.8	-1.8	-1.9	-1.9	-2	-2	-2	-2.1	-2.1	-2.1	-2.1	-1.9	-1.8];
volmax = -1.22; %%%%%%%%%%%%%%%%%%%% <-------------SELECCIONAR el valor de voltaje hasta el que se considera, inicialmente, que esta el 0
N=find(Vr == volmax);
n = 0; x(1) = 0; y(1) = 0;
for n = N:size(Vr,2)
  x(n-(N-1)) = Vr(n);
  y(n-(N-1)) = I(n);
end

prom=mean(y)
destan=std(y)
size(y,2)
xx = -4:1:0;Isup =prom+3*destan; Iprom= prom; Iinf = prom-3*destan; deltaI = 3*destan;
yysup = Isup*ones(1,5);
yyprom = Iprom*ones(1,5);
yyinf = Iinf*ones(1,5);
Vosup=-1.24; %%%%%%%%%%%%%%%%%%%% <-------------
Voinf=-1.15; %%%%%%%%%%%%%%%%%%%% <-------------SELECCIONAR el rango para el cual se considera que esta el primer voltaje fuera de la region 0
Vo=(Vosup+Voinf)/2
deltaVo=Vo-Vosup
xinf = Vo-((0.4/0.1)-1)*deltaVo; xsup = Vo+((0.4/0.1)-1)*deltaVo; ysup = Iprom+((0.45/0.05)-1)*deltaI;yinf = Iprom-((0.45/0.05)-1)*deltaI;
yf1= yinf:0.1:ysup;
xf1= Vosup*ones(1,length(yf1));
yf2= yinf:0.1:ysup;
xf2= Vo*ones(1,length(yf2));
yf3= yinf:0.1:ysup;
xf3= Voinf*ones(1,length(yf3));

figure(1);clf;
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
subplot(2,2,1:2)
plot (Vr,I,'r.');grid on;
xlabel('V_{r}[V]');ylabel('I[A]');
legend('Datos Experimentales','Location','northwest')
title('Relacion de I en funcion de V_{r}')
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
subplot(2,2,3:4)
plot (x,y,'c.');grid on;
axis([-4 0 -20 100])
xlabel('V_{r}[V]');ylabel('I[A]');
legend('Datos Experimentales')
title('Primera consideracion de puntos como I=0')

figure(2);clf;
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
subplot(2,1,1)
plot (Vr,I,'r.',xx,yysup,'m-',xx,yyprom,'b-',xx,yyinf,'m-');grid on;
axis([-4 0 -20 100])
title('A)')
xlabel('V_{r}[V]');ylabel('I[A]');
legend('Datos Experimentales','I_{prom}+3\sigma','I_{prom}','I_{prom}-3\sigma','Location','northwest')
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
subplot(2,1,2)
plot (Vr,I,'r.',xx,yysup,'m-',xx,yyprom,'b-',xx,yyinf,'m-');grid on;
title('B)')
xlabel('V_{r}[V]');ylabel('I[A]');
axis([-4 0 -2.5 -0.5])
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
figure(3);clf;
plot (Vr,I,'r*',xx,yysup,'m-',xx,yyprom,'b-',xx,yyinf,'m-',xf1,yf1,'g',xf2,yf2,'k',xf3,yf3,'g');grid on;
title('C)')
axis([xinf xsup yinf ysup])
xlabel('V_{r}[V]');ylabel('I[A]');
legend('Datos Experimentales','I_{prom}+3\sigma','I_{prom}','I_{prom}-3\sigma','V_{o-sup}','V_{o}','V_{o-inf}','Location','southwest')